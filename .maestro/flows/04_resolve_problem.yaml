# Resolve Problem Flow - Smoke Test
# Tests: User can resolve an existing problem
# Prerequisites: Must have at least one unresolved problem visible
# Tags: smoke, problems

appId: com.brianrosen.stripcall
tags:
  - smoke
  - problems

---
# Ensure we're on the problems page with a problem visible
- assertVisible:
    id: "problems_report_button"

# Tap on the problem card to expand it
- tapOn:
    id: "problem_card_.*"
    index: 0
- waitForAnimationToEnd

# Tap on the Resolve button on the expanded problem card
- tapOn:
    text: "Resolve"

# Wait for resolve dialog to appear
- waitForAnimationToEnd
- extendedWaitUntil:
    visible:
      id: "resolve_problem_dialog"
    timeout: 5000

# Select an action from dropdown
- tapOn:
    id: "resolve_problem_action_dropdown"
- waitForAnimationToEnd

# Select the resolution action
- tapOn:
    text: "Replaced blade"
- waitForAnimationToEnd

# Tap the Resolve button in the dialog
- tapOn:
    text: "^Resolve$"

# Wait for dialog to close
- waitForAnimationToEnd
- extendedWaitUntil:
    visible:
      id: "problems_report_button"
    timeout: 10000

# Verify we're back on problems page
- assertVisible:
    id: "problems_report_button"
